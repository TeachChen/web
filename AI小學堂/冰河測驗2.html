<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾ä»£å†°æ²³æœŸçŸ¥è­˜æ¸¬é©—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
        }
        .option-btn.correct {
            background-color: #10b981 !important;
            border-color: #10b981 !important;
            color: white !important;
        }
        .option-btn.wrong {
            background-color: #ef4444 !important;
            border-color: #ef4444 !important;
            color: white !important;
            opacity: 0.7;
        }
        .input-field {
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 text-slate-800">

    <div class="glass-card w-full max-w-2xl p-8 relative overflow-hidden">
        
        <!-- Decorative Ice Elements -->
        <div class="absolute -top-10 -right-10 text-9xl text-blue-100 opacity-50 pointer-events-none">
            <i class="fas fa-snowflake"></i>
        </div>
        <div class="absolute bottom-10 -left-10 text-8xl text-blue-50 opacity-50 pointer-events-none">
            <i class="fas fa-icicles"></i>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="text-center relative z-10">
            <div class="mb-4 inline-block p-4 rounded-full bg-blue-100 text-blue-600 text-4xl">
                <i class="fas fa-globe-americas"></i>
            </div>
            <h1 class="text-3xl font-bold mb-2 text-slate-800">ç¾ä»£å†°æ²³æœŸçŸ¥è­˜å¤§è€ƒé©—</h1>
            <p class="text-md text-slate-600 mb-6">è«‹è¼¸å…¥åŸºæœ¬è³‡æ–™é–‹å§‹æ¸¬é©—</p>

            <!-- Input Fields Section -->
            <div class="bg-blue-50 p-6 rounded-xl mb-6 max-w-md mx-auto text-left shadow-sm border border-blue-100">
                <div class="mb-4">
                    <label for="student-class" class="block text-sm font-bold text-slate-700 mb-2">ç­ç´š</label>
                    <input type="text" id="student-class" placeholder="ä¾‹å¦‚ï¼š801" class="input-field w-full p-3 rounded-lg border border-gray-300 text-lg">
                </div>
                <div class="mb-4">
                    <label for="student-name" class="block text-sm font-bold text-slate-700 mb-2">å§“å</label>
                    <input type="text" id="student-name" placeholder="è«‹è¼¸å…¥å§“å" class="input-field w-full p-3 rounded-lg border border-gray-300 text-lg">
                </div>
                <div class="mb-2">
                    <label for="student-no" class="block text-sm font-bold text-slate-700 mb-2">åº§è™Ÿ (é¸å¡«)</label>
                    <input type="number" id="student-no" placeholder="ä¾‹å¦‚ï¼š15" class="input-field w-full p-3 rounded-lg border border-gray-300 text-lg">
                </div>
                <p id="input-error" class="text-red-500 text-sm mt-2 hidden"><i class="fas fa-exclamation-circle"></i> è«‹å®Œæ•´å¡«å¯«ç­ç´šèˆ‡å§“åï¼</p>
            </div>

            <button onclick="startQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 text-lg w-full max-w-xs">
                é–‹å§‹æ¸¬é©— <i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden relative z-10">
            <!-- User Info Header -->
            <div class="flex justify-between items-center bg-white/50 p-2 rounded-lg mb-4 text-xs md:text-sm text-slate-600">
                <span><i class="fas fa-user mr-1"></i> <span id="display-info"></span></span>
                <span id="score-display" class="font-bold text-blue-600">å¾—åˆ†: 0</span>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <div class="flex justify-between items-center mb-4">
                <span class="text-sm font-medium text-blue-600 bg-blue-50 px-3 py-1 rounded-full">
                    ç¬¬ <span id="current-question-num">1</span> / 5 é¡Œ
                </span>
            </div>

            <h2 id="question-text" class="text-xl md:text-2xl font-bold mb-6 text-slate-800 min-h-[4rem]">
                é¡Œç›®è¼‰å…¥ä¸­...
            </h2>

            <div id="options-container" class="space-y-3">
                <!-- Options will be injected here -->
            </div>

            <div id="feedback-area" class="hidden mt-6 p-4 rounded-lg bg-gray-50 border-l-4">
                <p id="feedback-text" class="font-medium text-lg mb-1"></p>
                <p id="explanation-text" class="text-sm text-gray-600"></p>
                <button onclick="nextQuestion()" id="next-btn" class="mt-4 bg-slate-800 hover:bg-slate-900 text-white font-bold py-2 px-6 rounded-lg transition">
                    ä¸‹ä¸€é¡Œ
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden text-center relative z-10">
            <div id="result-icon" class="mb-4 text-6xl animate-bounce"></div>
            <h2 class="text-3xl font-bold mb-2">æ¸¬é©—çµæŸï¼</h2>
            <p class="text-xl text-slate-600 mb-6">ä½ çš„æœ€çµ‚æˆç¸¾</p>
            
            <div class="text-6xl font-black text-blue-600 mb-6">
                <span id="final-score">0</span><span class="text-2xl text-gray-400">/100</span>
            </div>

            <!-- Upload Status -->
            <div id="upload-status" class="mb-6 p-3 rounded-lg bg-gray-100 inline-flex items-center">
                <i class="fas fa-spinner fa-spin text-blue-500 mr-2"></i>
                <span class="text-gray-600">æ­£åœ¨å„²å­˜æˆç¸¾è‡³é›²ç«¯...</span>
            </div>
            
            <p id="result-message" class="text-lg font-medium mb-8 text-slate-500"></p>

            <button onclick="resetQuiz()" class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-3 px-8 rounded-full shadow-md transition transform hover:scale-105">
                <i class="fas fa-redo mr-2"></i> é‡æ–°æ¸¬é©— (ä¸é‡è¤‡è¨ˆåˆ†)
            </button>
        </div>

    </div>

    <script>
        // ==========================================
        // CONFIGURATION: Paste your GAS Web App URL here
        // ==========================================
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyLLG7m-MP9RrQH8i4YJiivEXCa7aH287WJeNTvk59EsvpbGvdWF1oT1ADIyuCaxXd0vQ/exec'; 
        // ä¾‹å¦‚: const GAS_URL = 'https://script.google.com/macros/s/AKfycbx.../exec';
        // ==========================================

        const quizData = [
            {
                question: "æ ¹æ“šç§‘å­¸å®šç¾©ï¼Œåœ°çƒç›®å‰ä¹‹æ‰€ä»¥è¢«èªç‚ºè™•æ–¼ã€Œå†°æ²³æ™‚æœŸã€ï¼Œä¸»è¦åŸå› æ˜¯ä»€éº¼ï¼Ÿ",
                options: [
                    "å› ç‚ºå…¨çƒå¹³å‡æ°£æº«åœ¨æ”æ°0åº¦ä»¥ä¸‹",
                    "å› ç‚ºåœ°çƒçš„å…©æ¥µï¼ˆå—æ¥µèˆ‡æ ¼é™µè˜­ï¼‰ä»å­˜åœ¨æ°¸ä¹…æ€§çš„å†°è“‹",
                    "å› ç‚ºå¤ªé™½æ´»å‹•ç›®å‰è™•æ–¼æœ€ä½é»",
                    "å› ç‚ºæµ·æ´‹ç›®å‰å®Œå…¨çµå†°"
                ],
                correct: 1,
                explanation: "åªè¦åœ°çƒè¡¨é¢æœ‰æ°¸ä¹…æ€§çš„æ¥µåœ°å†°è“‹å­˜åœ¨ï¼Œç§‘å­¸ä¸Šå°±å®šç¾©ç‚ºè™•æ–¼ã€Œå†°æ²³æ™‚æœŸã€ã€‚æˆ‘å€‘ç›®å‰è™•æ–¼å…¶ä¸­çš„ã€Œé–“å†°æœŸã€ã€‚"
            },
            {
                question: "æˆ‘å€‘ç›®å‰æ­£è™•æ–¼å†°æ²³æ™‚æœŸä¸­ç›¸å°æº«æš–çš„éšæ®µï¼Œé€™å€‹éšæ®µç¨±ç‚ºä»€éº¼ï¼Ÿ",
                options: [
                    "å°å†°æœŸ (Little Ice Age)",
                    "å†°æœŸ (Glacial Period)",
                    "é–“å†°æœŸ (Interglacial Period)",
                    "æº«å®¤æœŸ (Greenhouse Period)"
                ],
                correct: 2,
                explanation: "å†°æ²³æ™‚æœŸåŒ…å«äº†å¯’å†·çš„ã€Œå†°æœŸã€èˆ‡æº«æš–çš„ã€Œé–“å†°æœŸã€ã€‚æˆ‘å€‘ç›®å‰è™•æ–¼ã€Œå…¨æ–°ä¸–é–“å†°æœŸã€ã€‚"
            },
            {
                question: "å½±éŸ¿åœ°çƒå†°æ²³æœŸèˆ‡é–“å†°æœŸé€±æœŸæ€§è®ŠåŒ–çš„å¤©æ–‡å› ç´ ï¼ˆåœ°çƒè»Œé“è®ŠåŒ–ï¼‰ç¨±ç‚ºä»€éº¼ï¼Ÿ",
                options: [
                    "æœˆçƒå¼•åŠ›å¾ªç’°",
                    "ç±³è˜­ç§‘ç¶­å¥‡å¾ªç’° (Milankovitch Cycles)",
                    "å“ˆé›·å½—æ˜Ÿé€±æœŸ",
                    "æ¿å¡Šæ§‹é€ é‹å‹•"
                ],
                correct: 1,
                explanation: "ç±³è˜­ç§‘ç¶­å¥‡å¾ªç’°æè¿°äº†åœ°çƒè»Œé“å½¢ç‹€ã€åœ°è»¸å‚¾æ–œåº¦å’Œé€²å‹•çš„é•·æœŸè®ŠåŒ–ï¼Œå½±éŸ¿äº†æ—¥ç…§é‡ã€‚"
            },
            {
                question: "æ­·å²ä¸Š 14-19 ä¸–ç´€çš„çŸ­æš«å¯’å†·æ™‚æœŸï¼ˆå¦‚æ³°æ™¤å£«æ²³çµå†°ï¼‰è¢«ç¨±ç‚ºä»€éº¼ï¼Ÿ",
                options: [
                    "å¤§å†°æ²³æœŸ",
                    "æ–°ä»™å¥³æœ¨æœŸ",
                    "å°å†°æ²³æœŸ (Little Ice Age)",
                    "é›ªçƒåœ°çƒ"
                ],
                correct: 2,
                explanation: "é€™æ®µæ™‚æœŸè¢«ç¨±ç‚ºã€Œå°å†°æ²³æœŸã€ï¼Œå¯èƒ½ç”±å¤ªé™½æ´»å‹•æ¸›å¼±å’Œç«å±±çˆ†ç™¼å¼•èµ·ã€‚"
            },
            {
                question: "ç§‘å­¸å®¶æ“”å¿ƒäººé¡æº«å®¤æ°£é«”æ’æ”¾å¯èƒ½æœƒå°è‡´ä»€éº¼çµæœï¼Ÿ",
                options: [
                    "åŠ é€Ÿä¸‹ä¸€æ¬¡å†°æœŸ",
                    "å®Œå…¨æ²’æœ‰å½±éŸ¿",
                    "å»¶é²ç”šè‡³å–æ¶ˆä¸‹ä¸€æ¬¡å†°æœŸçš„åˆ°ä¾†",
                    "å°è‡´æµ·å¹³é¢ä¸‹é™"
                ],
                correct: 2,
                explanation: "æº«å®¤æ•ˆæ‡‰å¯èƒ½æœƒæ‰“ç ´è‡ªç„¶çš„å†°æ²³å¾ªç’°ï¼Œé€ æˆã€Œå»¶é²çš„å†°æ²³æœŸã€ã€‚"
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;
        let isAnswered = false;
        let studentInfo = {
            class: '',
            name: '',
            no: ''
        };

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackText = document.getElementById('feedback-text');
        const explanationText = document.getElementById('explanation-text');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionNum = document.getElementById('current-question-num');
        const scoreDisplay = document.getElementById('score-display');
        const finalScore = document.getElementById('final-score');
        const resultMessage = document.getElementById('result-message');
        const resultIcon = document.getElementById('result-icon');
        const displayInfo = document.getElementById('display-info');
        const uploadStatus = document.getElementById('upload-status');

        // Input Elements
        const inputClass = document.getElementById('student-class');
        const inputName = document.getElementById('student-name');
        const inputNo = document.getElementById('student-no');
        const inputError = document.getElementById('input-error');

        function startQuiz() {
            const sClass = inputClass.value.trim();
            const sName = inputName.value.trim();
            const sNo = inputNo.value.trim();

            if (!sClass || !sName) {
                inputError.classList.remove('hidden');
                // Shake animation effect
                const box = document.querySelector('.glass-card');
                box.style.transform = "translateX(10px)";
                setTimeout(() => box.style.transform = "translateX(0)", 100);
                return;
            }

            studentInfo = { class: sClass, name: sName, no: sNo };
            displayInfo.textContent = `${sClass} ${sNo ? sNo + 'è™Ÿ' : ''} ${sName}`;
            inputError.classList.add('hidden');

            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadQuestion();
        }

        function loadQuestion() {
            isAnswered = false;
            feedbackArea.classList.add('hidden');
            const currentData = quizData[currentQuestionIndex];
            
            questionText.textContent = currentData.question;
            currentQuestionNum.textContent = currentQuestionIndex + 1;
            
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;

            optionsContainer.innerHTML = '';
            currentData.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full text-left p-4 rounded-xl border-2 border-blue-100 bg-white hover:bg-blue-50 text-lg font-medium text-slate-700';
                button.innerHTML = `<span class="inline-block w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-center leading-8 mr-3 text-sm font-bold">${String.fromCharCode(65 + index)}</span> ${option}`;
                button.onclick = () => checkAnswer(index, button);
                optionsContainer.appendChild(button);
            });

            nextBtn.textContent = (currentQuestionIndex === quizData.length - 1) ? "æŸ¥çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ";
        }

        function checkAnswer(selectedIndex, selectedButton) {
            if (isAnswered) return;
            isAnswered = true;

            const currentData = quizData[currentQuestionIndex];
            const buttons = optionsContainer.getElementsByTagName('button');

            if (selectedIndex === currentData.correct) {
                selectedButton.classList.add('correct');
                score += 20;
                feedbackText.textContent = "ğŸ‰ ç­”å°äº†ï¼";
                feedbackText.className = "font-medium text-lg mb-1 text-green-600";
                feedbackArea.classList.add('border-green-500');
                feedbackArea.classList.remove('border-red-500');
            } else {
                selectedButton.classList.add('wrong');
                buttons[currentData.correct].classList.add('correct');
                feedbackText.textContent = "âŒ ç­”éŒ¯äº†ï¼";
                feedbackText.className = "font-medium text-lg mb-1 text-red-500";
                feedbackArea.classList.add('border-red-500');
                feedbackArea.classList.remove('border-green-500');
            }

            Array.from(buttons).forEach(btn => btn.disabled = true);
            scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
            explanationText.textContent = currentData.explanation;
            feedbackArea.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            // Animation for score
            let displayScore = 0;
            const scoreInterval = setInterval(() => {
                if (displayScore < score) {
                    displayScore++;
                    finalScore.textContent = displayScore;
                } else {
                    clearInterval(scoreInterval);
                }
            }, 20);
            
            finalScore.textContent = score;

            // Feedback messages
            if (score === 100) {
                resultMessage.textContent = "å¤ªå²å®³äº†ï¼ä½ æ˜¯å†°æ²³æœŸå°ˆå®¶ï¼ ğŸ†";
                resultIcon.innerHTML = "ğŸŒŸ";
            } else if (score >= 80) {
                resultMessage.textContent = "è¡¨ç¾å¾ˆæ£’ï¼æŒæ¡äº†å¤§éƒ¨åˆ†çŸ¥è­˜ï¼ ğŸ‘";
                resultIcon.innerHTML = "ğŸ˜";
            } else if (score >= 60) {
                resultMessage.textContent = "é‚„ä¸éŒ¯ï¼Œå†è¤‡ç¿’ä¸€ä¸‹å½±ç‰‡æœƒæ›´å¥½ï¼ ğŸ‘";
                resultIcon.innerHTML = "ğŸ“š";
            } else {
                resultMessage.textContent = "åŠ æ²¹ï¼å†çœ‹ä¸€æ¬¡å½±ç‰‡ä¾†æŒ‘æˆ°å§ï¼ ğŸ’ª";
                resultIcon.innerHTML = "ğŸŒ±";
            }

            // Send data to GAS
            sendDataToGAS();
        }

        function sendDataToGAS() {
            if (GAS_URL === 'è«‹åœ¨æ­¤è²¼ä¸Šæ‚¨çš„GASç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€' || GAS_URL === '') {
                uploadStatus.innerHTML = '<i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i> <span class="text-gray-600">æœªè¨­å®š GAS ç¶²å€ï¼Œç„¡æ³•å„²å­˜æˆç¸¾ã€‚</span>';
                return;
            }

            const data = {
                timestamp: new Date().toISOString(),
                class: studentInfo.class,
                name: studentInfo.name,
                no: studentInfo.no,
                score: score
            };

            // Use 'no-cors' mode to send data without waiting for response (avoids CORS errors in simple setup)
            // Or use text/plain content type to avoid preflight
            fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8',
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                // Note: With GAS simple triggers and text/plain, we often get an opaque response
                // but if it doesn't throw, it usually worked.
                uploadStatus.innerHTML = '<i class="fas fa-check-circle text-green-500 mr-2"></i> <span class="text-green-600 font-bold">æˆç¸¾å·²æˆåŠŸå„²å­˜ï¼</span>';
                uploadStatus.classList.add('bg-green-50');
                uploadStatus.classList.remove('bg-gray-100');
            })
            .catch(error => {
                console.error('Error:', error);
                uploadStatus.innerHTML = '<i class="fas fa-times-circle text-red-500 mr-2"></i> <span class="text-red-600">å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚</span>';
                uploadStatus.classList.add('bg-red-50');
                uploadStatus.classList.remove('bg-gray-100');
            });
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            scoreDisplay.textContent = "å¾—åˆ†: 0";
            progressBar.style.width = "0%";
            resultScreen.classList.add('hidden');
            
            // Reset to start screen to allow new user? Or just reset quiz for same user?
            // Usually reload is cleaner for a new user, but here let's go back to start screen
            inputClass.value = '';
            inputName.value = '';
            inputNo.value = '';
            studentInfo = {};
            uploadStatus.innerHTML = '<i class="fas fa-spinner fa-spin text-blue-500 mr-2"></i> <span class="text-gray-600">æ­£åœ¨å„²å­˜æˆç¸¾è‡³é›²ç«¯...</span>'; // Reset status HTML
            
            startScreen.classList.remove('hidden');
        }
    </script>
</body>
</html>